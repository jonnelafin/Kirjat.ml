<!DOCTYPE html>
<html>
<head>
	<title>Kirjat.ml</title>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
	<meta charset="UTF-8">
	
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
</head>
<body>
	<div class="d-flex justify-content-center">
		<h1> Kirjat.ml </h1><br>
	</div>
	<div class="d-flex justify-content-center">
		<textarea cols=75 rows=7 placeholder="Kirjoita kirjojen nimet tähän, yksi per rivi" class="" id="input" ></textarea>
	</div>
	<br>
	<div class="d-flex justify-content-center">
		<button class="btn btn-primary" onclick="query()"> Hae </button>
	</div>
	<hr>
	<div class="d-flex justify-content-center" id="results">
	</div>
</body>
<footer>
<template id="cardTemplate">
	<div class="card" style="width: 18rem;">
	  <img class="card-img-top" src="" alt="Ei kuvaa" id="card-img-top">
	  <div class="card-body" id="card-body">
		<h5 class="card-title" id="card-title">Card title</h5>
		<p class="card-text" id="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
		<p class="card-text" id="card-text2">Max 10€</p>
		<a href="#" class="btn btn-primary ">Go somewhere</a>
	  </div>
	</div>
</template>
<script>
	function query() {
		document.getElementById("results").innerHTML = "";
		var val = document.getElementById("input").value;
		let formData = new FormData();
		formData.append('querym', val);
		(async () => {
		  const rawResponse = await fetch('https://kirjat-ml.herokuapp.com/api/v1', {
			method: 'POST',
			headers: {
			},
			body: formData
		  });
		  const content = await rawResponse.json();

		  console.log(content);
		  var stuff = content;
		  for(thing in stuff){
			console.log(thing);
			var cont = stuff[thing]["data"];
			console.log("cont: ");
			console.log(cont);
			for(booko in cont){
				var book = cont[booko];
				var name = book["name"];
				console.log(name);
				var id = book["id"];
				var image = book["image"];
				var link = book["link"];
				var prices = book["prices"];
				var conditions = book["conditions"];
				var price = book["price"];
				if (price != -1){
					addCard(name, conditions, prices, image);
				}
			}
		  }
		})();
	}
	function formatE(price){
		var index = price.length - 2;
		return price.substring(0, index) + "," + price.substring(index);
	}
	function addCard(name, conditions, prices, image) {
		if ('content' in document.createElement('template')) {

			// Instantiate the table with the existing HTML tbody
			// and the row with the template
			var tbody = document.getElementById("results")
			var template = document.getElementById('cardTemplate');

			// Clone the new row and insert it into the table
			var clone = template.content.cloneNode(true);
			var td = clone.querySelector("#card-body");
			td.querySelector("#card-title").textContent = name;
			td.querySelector("#card-text").textContent = conditions[0];
			td.querySelector("#card-text2").textContent = "Max " + formatE(prices[0]+"") + "€";
			var img = clone.querySelector("#card-img-top");
			img.src = image;

			tbody.appendChild(clone);
			console.log(clone);

		} else {
		  // Find another way to add the rows to the table because 
		  // the HTML template element is not supported.
		}
	}
</script>
</footer>
</html>
